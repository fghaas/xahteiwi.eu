<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Maintenance in active Pacemaker clusters - xahteiwi.eu</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://fghaas.github.io/xahteiwi.eu/resources/hints-and-kinks/maintenance-active-pacemaker-clusters/">

        <meta name="author" content="Florian Haas" />
        <meta name="keywords" content="Pacemaker" />
        <meta name="description" content="In a Pacemaker cluster, as in a standalone system, operators must complete maintenance tasks such as software upgrades and configuration changes. Here&#39;s what you need to keep Pacemaker&#39;s built-in monitoring features from creating unwanted side effects. Maintenance mode This is quite possibly Pacemaker&#39;s single most useful feature for cluster maintenance …" />

        <meta property="og:site_name" content="xahteiwi.eu" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Maintenance in active Pacemaker clusters"/>
        <meta property="og:url" content="https://fghaas.github.io/xahteiwi.eu/resources/hints-and-kinks/maintenance-active-pacemaker-clusters/"/>
        <meta property="og:description" content="In a Pacemaker cluster, as in a standalone system, operators must complete maintenance tasks such as software upgrades and configuration changes. Here&#39;s what you need to keep Pacemaker&#39;s built-in monitoring features from creating unwanted side effects. Maintenance mode This is quite possibly Pacemaker&#39;s single most useful feature for cluster maintenance …"/>
        <meta property="article:published_time" content="2012-09-24" />
            <meta property="article:section" content="hints-and-kinks" />
            <meta property="article:tag" content="Pacemaker" />
            <meta property="article:author" content="Florian Haas" />

    <meta name="twitter:dnt" content="on">
    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@xahteiwi">
        <meta name="twitter:creator" content="@xahteiwi">
    <meta name="twitter:domain" content="https://fghaas.github.io/xahteiwi.eu">


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://fghaas.github.io/xahteiwi.eu/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="https://fghaas.github.io/xahteiwi.eu/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://fghaas.github.io/xahteiwi.eu/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fghaas.github.io/xahteiwi.eu/theme/css/style.css" type="text/css"/>

        <link href="https://fghaas.github.io/xahteiwi.eu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="xahteiwi.eu ATOM Feed"/>




</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://fghaas.github.io/xahteiwi.eu/" class="navbar-brand">
xahteiwi.eu            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="https://fghaas.github.io/xahteiwi.eu/category/blog.html">Blog</a>
                        </li>
                        <li class="active">
                            <a href="https://fghaas.github.io/xahteiwi.eu/category/hints-and-kinks.html">Hints-and-kinks</a>
                        </li>
                        <li >
                            <a href="https://fghaas.github.io/xahteiwi.eu/category/presentations.html">Presentations</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://fghaas.github.io/xahteiwi.eu/resources/hints-and-kinks/maintenance-active-pacemaker-clusters/"
                       rel="bookmark"
                       title="Permalink to Maintenance in active Pacemaker clusters">
                        Maintenance in active Pacemaker clusters
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2012-09-24T19:49:31+01:00"> Mon 24 September 2012</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://fghaas.github.io/xahteiwi.eu/tag/pacemaker.html">Pacemaker</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>In a Pacemaker cluster, as in a standalone system, operators must
complete maintenance tasks such as software upgrades and configuration
changes. Here's what you need to keep Pacemaker's built-in monitoring
features from creating unwanted side effects.</p>
<h2>Maintenance mode</h2>
<p>This is quite possibly Pacemaker's single most useful feature for
cluster maintenance. In maintenance mode, Pacemaker essentially takes
a "hands-off" approach to your cluster. Enabling Pacemaker maintenance
mode is very easy using the Pacemaker <code>crm</code> shell:</p>
<div class="highlight"><pre><span></span>crm configure property maintenance-mode<span class="o">=</span><span class="nb">true</span>
</pre></div>
<p>In maintenance mode, you can stop or restart cluster resources at
will. Pacemaker will not attempt to restart them. All resources
automatically become unmanaged, that is, Pacemaker will cease
monitoring them and hence be oblivious about their status. You can
even stop all Pacemaker services on a node, and all the daemons and
processes originally started as Pacemaker managed cluster resources
will continue to run.</p>
<p>You should know that when you start Pacemaker services on a node while
the cluster in maintenance mode, Pacemaker will initiate a single
one-shot monitor operation (a "probe") for every resource just so it
has an understanding of what resources are currently running on that
node. It will, however, take no further action other than determining
the resources' status.</p>
<p>You disable maintenance mode with the crm shell, as well:</p>
<div class="highlight"><pre><span></span>crm configure property maintenance-mode<span class="o">=</span><span class="nb">false</span>
</pre></div>
<p>Maintenance mode is something you enable before running other
maintenance actions, not when you're already half-way through
them. And unless you're very well versed in the interdependencies of
resources running on the cluster you're working on, it's usually the
very safest option.</p>
<p>In short: when doing maintenance on your Pacemaker cluster, by
default, enable maintenance mode before you start, and disable it
after you're done.</p>
<h2>Disabling monitoring and error recovery on specific resources</h2>
<p>For any configuration changes that take no more than a few minutes,
involving an admin that is potentially watching a console window the
whole time, maintenance mode is highly recommended. However, enabling
maintenance mode can be a bit hard to argue for large configuration
changes lasting, say, several hours. Think of a massive database
rebuild, for example. In such a case, you may want to put only your
database resource in something like maintenance mode, and have
Pacemaker continue to monitor other resources like normal.</p>
<p>You can do so by switching the resource to unmanaged mode and disable
its monitor operation:</p>
<div class="highlight"><pre><span></span>crm configure edit p_database
</pre></div>
<p>Then change the <code>is-managed</code> meta  attribute and disable the <code>monitor</code>
operation:</p>
<div class="highlight"><pre><span></span>meta is-managed=false
op monitor interval=&lt;interval&gt; enabled=false
</pre></div>
<p>Once you've done that, you'll effectively have enabled something akin
to maintenance mode for a single resource. You can reverse this as you
would expect:</p>
<div class="highlight"><pre><span></span>crm configure edit p_database
</pre></div>
<p>Then change the <code>is-managed</code> meta attribute and re-enable the
<code>monitor</code> operation:</p>
<div class="highlight"><pre><span></span>meta is-managed=true
op monitor interval=&lt;interval&gt; enabled=true
</pre></div>
<p>When using this approach, all other resources will be monitored and
automatically recovered as they normally would. Thus, you'll have to
be acutely aware of any side effects your maintenance activities have
on other resources. If you're unsure, you should use the global
maintenance mode instead.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="https://fghaas.github.io/xahteiwi.eu/images/avatar.jpg"/>
        </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="https://twitter.com/xahteiwi"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
    <li class="list-group-item"><a href="https://www.linkedin.com/in/fghaas"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
    <li class="list-group-item"><a href="https://reddit.com/u/fghaas"><i class="fa fa-reddit-square fa-lg"></i> Reddit</a></li>
    <li class="list-group-item"><a href="https://github.com/fghaas"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="https://fghaas.github.io/xahteiwi.eu/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/ansible.html">Ansible</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/ceph.html">Ceph</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/cloudify.html">Cloudify</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/conference.html">Conference</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/containers.html">Containers</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/corosync.html">Corosync</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/development.html">Development</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/drbd.html">DRBD</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/flashcache.html">Flashcache</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/galera.html">Galera</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/glusterfs.html">GlusterFS</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/heat.html">Heat</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/high-availability.html">High Availability</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/juju.html">Juju</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/kvm.html">KVM</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/lca2014.html">lca2014</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/libvirt.html">libvirt</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/lxc.html">LXC</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/mysql.html">MySQL</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/open-edx.html">Open edX</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/openstack.html">OpenStack</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/oscon.html">OSCON</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/pacemaker.html">Pacemaker</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/performance.html">Performance</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/philosophy.html">Philosophy</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/python.html">Python</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/suse.html">SUSE</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://fghaas.github.io/xahteiwi.eu/tag/ubuntu.html">Ubuntu</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="/legal" target="_blank">Legal info</a>
    </li>
    <li class="list-group-item">
      <a href="http://getpelican.com/" target="_blank">Pelican</a>
    </li>
    <li class="list-group-item">
      <a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Florian Haas
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en">Creative Commons Attribution-ShareAlike 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://fghaas.github.io/xahteiwi.eu/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://fghaas.github.io/xahteiwi.eu/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://fghaas.github.io/xahteiwi.eu/theme/js/respond.min.js"></script>




</body>
</html>